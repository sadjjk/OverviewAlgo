# 综合评价法-TOPSIS法

#### 理论概述

基于优劣解距离来综合衡量指标的客观权重

采用余弦法找出有限方案中的最优方案和最劣方案

然后分别计算各评价对象与最优方案和最劣方案间的距离

获得各评价对象与最优方案的相对接近程度，以此作为评价优劣的依据

#### 数据说明

设共有$n$ 个待评价对象，每个对象都有$m$个指标(属性)，即如下所示：
$$
\begin{pmatrix}  
  x_{11} & x_{12} & \cdots & x_{1m} \\  
  x_{21} & x_{22} & \cdots & x_{2m} \\  
  \vdots & \vdots & \ddots & \vdots \\  
  x_{n1} & x_{n2} & \cdots & x_{nm}  
\end{pmatrix}
$$
举例数据

| 编号    | 专业课1 | 专业课2 | 专业课3 | 专业课4 |
| ------- | ------- | ------- | ------- | ------- |
| 应聘者1 | 67      | 90      | 67      | 81      |
| 应聘者2 | 82      | 73      | 95      | 85      |
| 应聘者3 | 67      | 92      | 79      | 78      |
| 应聘者4 | 82      | 81      | 86      | 76      |
| 应聘者5 | 70      | 91      | 82      | 89      |
| 应聘者6 | 72      | 90      | 89      | 74      |
| 应聘者7 | 82      | 85      | 92      | 69      |
| 应聘者8 | 85      | 72      | 72      | 92      |
| 应聘者9 | 82      | 69      | 71      | 86      |

#### 计算步骤

##### 1.数据预处理

若数据已量纲化和同向化 则可忽略此步骤

由于举例数据的各项指标均处于0~100分 均为正向

使用正则化 2-范数 进行去量纲化
$$
z_{i j}=\frac{x_{i j}}{\sqrt{\sum_{i=1}^{n} x_{i j}^{2}}}
$$
处理后得到标准化矩阵$Z$
$$
Z=\left[\begin{array}{cccc}
z_{11} & z_{12} & \cdots & z_{1 m} \\
z_{21} & z_{22} & \cdots & z_{2 m} \\
\vdots & \vdots & \ddots & \vdots \\
z_{n 1} & z_{n 2} & \cdots & z_{n m}
\end{array}\right]
$$

| 编号    | 专业课1 | 专业课2 | 专业课3 | 专业课4 |
| ------- | ------- | ------- | ------- | ------- |
| 应聘者1 | 0.0972  | 0.1211  | 0.0914  | 0.111   |
| 应聘者2 | 0.119   | 0.0983  | 0.1296  | 0.1164  |
| 应聘者3 | 0.0972  | 0.1238  | 0.1078  | 0.1068  |
| 应聘者4 | 0.119   | 0.109   | 0.1173  | 0.1041  |
| 应聘者5 | 0.1016  | 0.1225  | 0.1119  | 0.1219  |
| 应聘者6 | 0.1045  | 0.1211  | 0.1214  | 0.1014  |
| 应聘者7 | 0.119   | 0.1144  | 0.1255  | 0.0945  |
| 应聘者8 | 0.1234  | 0.0969  | 0.0982  | 0.126   |
| 应聘者9 | 0.119   | 0.0929  | 0.0969  | 0.1178  |

##### 2.确定最优方案和最劣方案

最优方案$Z^{+}$ 由$Z$ 中每列元素的最大值构成:
$$
Z^{+}=\left[\begin{array}{c}
\max \left\{z_{11}, z_{21}, \ldots, z_{n 1}\right\} \\
\max \left\{z_{12}, z_{22}, \ldots, z_{n 2}\right\} \\
\ldots \\
\max \left\{z_{1 m}, z_{2 m}, \ldots, z_{n m}\right.
\end{array}\right]=\left(Z_{1}^{+}, Z_{2}^{+}, \ldots, Z_{m}^{+}\right)
$$
举例数据$Z^{+}$

| 指标 | 专业课1 | 专业课2 | 专业课3 | 专业课4 |
| ---- | ------- | ------- | ------- | ------- |
| max  | 0.1234  | 0.1238  | 0.1296  | 0.126   |

最劣方案$Z^{-}$ 由$Z$中每列元素的最小值构成:

$$
Z^{-}=\left[\begin{array}{c}
\min \left\{z_{11}, z_{21}, \ldots, z_{n 1}\right\} \\
\min \left\{z_{12}, z_{22}, \ldots, z_{n 2}\right\} \\
\ldots \\
\min \left\{z_{1 m}, z_{2 m}, \ldots, z_{n m}\right.
\end{array}\right]=\left(Z_{1}^{-}, Z_{2}^{-}, \ldots, Z_{m}^{-}\right)
$$
举例数据 $Z^{-}$

| 指标 | 专业课1 | 专业课2 | 专业课3 | 专业课4 |
| ---- | ------- | ------- | ------- | ------- |
| min  | 0.0972  | 0.0929  | 0.0914  | 0.0945  |

##### 3.计算各评价对象与最优方案、最劣方案的接近程度

$$
\begin{aligned}
D_{i}^{+} &=\sqrt{\sum_{j=1}^{m}\left(Z_{j}^{+}-z_{i j}\right)^{2}} \\
D_{i}^{-} &=\sqrt{\sum_{j=1}^{m}\left(Z_{j}^{-}-z_{i j}\right)^{2}}
\end{aligned}
$$

##### 4.计算各评价对象与最优方案的贴近程度$C_{i}$

$$
C_{i}=\frac{D_{i}^{-}}{D_{i}^{+}+D_{i}^{-}}
$$

$0 \leq C_{i} \leq 1, C_{i} \rightarrow 1$表明评价对象越优。

##### 5.对象打分

| 对象    | 得分   |
| ------- | ------ |
| 应聘者1 | 0.3103 |
| 应聘者2 | 0.7615 |
| 应聘者3 | 0.4744 |
| 应聘者4 | 0.6329 |
| 应聘者5 | 0.719  |
| 应聘者6 | 0.6341 |
| 应聘者7 | 0.6529 |
| 应聘者8 | 0.5042 |
| 应聘者9 | 0.3307 |

#### 代码实践

```python
# 代码段
def get_topsis_score(data):
    data = np.array(data)
    data_scale = data / data.sum(axis=0)
    Z_add = np.max(data_scale, axis=0)
    Z_sub = np.min(data_scale, axis=0)
    D_add = np.square(Z_add - data_scale).sum(axis=1)
    D_sub = np.square(Z_sub - data_scale).sum(axis=1)
    return list(D_sub / (D_add+D_sub))
```

详情代码:  [TopsisModel.py](https://github.com/sadjjk/OverviewAlgo/blob/master/code/6.TopsisModel.py)

#### 熵权TOPSIS

即熵权法+TOPSIS法

在TOPSIS法的第3步中引入各指标合适的权重
$$
D_{i}^{+}=\sqrt{\sum_{j=1}^{m} w_{j}\left(Z_{j}^{+}-z_{i j}\right)^{2}}, \quad D_{i}^{-}=\sqrt{\sum_{j=1}^{m} w_{j}\left(Z_{j}^{-}-z_{i j}\right)^{2}}
$$
各指标权重由熵权法计算得出 

当然也可以由其他方法得出权重

