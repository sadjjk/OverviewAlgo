# 综合评价法-AHP层次分析法

#### 理论概述

又称"专家打分法" 

该方法将定量分析与定性分析结合起来 

用决策者的经验判断各衡量目标之间能否实现的标准之间的相对重要程度

并合理地给出每个决策方案的每个标准的权数

**说人话** 就是 

专家按照一定的标准给出各指标间的比较分值

然后检验一下分值拍脑袋是否拍的太离谱

若不离谱 则可得出各指标的权重 

进而计算出每个对象的最终得分

**这也是唯一一种不用关心数据本身分布的方法**

#### 数据说明

设共有$n$ 个待评价对象，每个对象都有$m$个指标(属性)，即如下所示：
$$
\begin{pmatrix}  
  x_{11} & x_{12} & \cdots & x_{1m} \\  
  x_{21} & x_{22} & \cdots & x_{2m} \\  
  \vdots & \vdots & \ddots & \vdots \\  
  x_{n1} & x_{n2} & \cdots & x_{nm}  
\end{pmatrix}
$$
假设数据为:

| 目标对象/维度 | 指标1 | 指标2 | 指标3 |
| :-----------: | :---: | :---: | :---: |
|     对象1     | 0.92  |  5.5  |   1   |
|     对象2     | 0.85  |   6   | 2.53  |
|     对象3     | 0.87  |  7.6  |  4.6  |
|     对象4     |  0.9  |  8.2  | 5.42  |
|     对象5     |  0.7  |  7.1  |  2.2  |

#### 计算步骤

##### 0.数据预处理

进行综合评价前 都要进行**量纲化**和**同向化**

若数据已量纲化和同向化 则可忽略此步骤

##### 1.构造成对矩阵

专家根据经验按以下标准给出分值 构造成对矩阵

| 指标i比指标j   | 分值       |
| -------------- | ---------- |
| 同等重要       | 1          |
| 稍微重要       | 3          |
| 较强重要       | 5          |
| 强烈重要       | 7          |
| 极端重要       | 9          |
| 介于各程度之间 | 2,4,6,8,10 |

成对比较矩阵的特点：$a_{i j}>0, a_{i j}=1, a_{i j}=\frac{1}{a_{j i}}$ (备注：当$i=j$时候，$a_{ij}=1$)假设成对矩阵如下:

| 评价  | 指标1 | 指标2 | 指标3 |
| ----- | ----- | ----- | ----- |
| 指标1 | 1     | 1/3   | 1/5   |
| 指标2 | 3     | 1     | 1/2   |
| 指标3 | 5     | 2     | 1     |

##### 2.计算成对矩阵的特征值和特征向量

特征值:[3.0037, -0.0018, -0.0018]

特征向量: 3 × 3 矩阵

| -0.164  | 0.082   | 0.082   |
| ------- | ------- | ------- |
| -0.4629 | 0.2314  | 0.2314  |
| -0.8711 | -0.8711 | -0.8711 |

##### 3.一致性校验

![sa6ShT.png](https://s3.ax1x.com/2021/01/14/sa6ShT.png)
$$
\begin{array}{c}
C I=\frac{\max (3.0037,-0.0018,-0.0018)-3}{3-1}=\frac{3.0037-3}{3-1} \\
=\frac{0.0037}{2}=0.00185
\end{array}
$$

$$
C R=\frac{C I}{R I}=\frac{0.00185}{0.52}=0.0036
$$

##### 4.计算权重

最大的特征值所对应的特征向量(转置)为 [-0.164, -0.4629,-0.8711 ]

归一化(当前值/求和值) =  [0.1095, 0.309, 0.5815]

这三个值即对应的三个指标的权重

##### 5.对象打分

| 目标对象/维度 | 指标1 | 指标2 | 指标3 |               计算方式               | 得分   |
| :-----------: | :---: | :---: | :---: | :----------------------------------: | ------ |
|     对象1     | 0.92  |  5.5  |   1   | 0.92 * 0.1095+5.5 * 0.309+1 * 0.5815 | 2.3817 |
|     对象2     | 0.85  |   6   | 2.53  | 0.85 * 0.1095+6 * 0.309+2.53*0.5815  | 3.4182 |
|     对象3     | 0.87  |  7.6  |  4.6  |  0.87*0.1095+7.6 * 0.309+4.6*0.5815  | 5.1186 |
|     对象4     |  0.9  |  8.2  | 5.42  |  0.9*0.1095+8.2 * 0.309+5.42*0.5815  | 5.7841 |
|     对象5     |  0.7  |  7.1  |  2.2  |  0.9*0.1095+7.1 *0.309+2.2 * 0.5815  | 3.5717 |

#### 代码实践

```
 ✔ python AHPModel.py 
请输入指标的个数:3
重要程度X:1~10  若A比B弱 则输入倒数:1/X
请输入第1个指标比第2个指标的重要程度:1/3
请输入第1个指标比第3个指标的重要程度:1/5
请输入第2个指标比第3个指标的重要程度:1/2
3个指标权重分别为:['10.95%', '30.90%', '58.15%']
```

详情代码: [AHPModel.py](https://github.com/sadjjk/OverviewAlgo/blob/master/code/4.AHPModel.py)